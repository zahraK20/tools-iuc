<tool id="cnvkit_segmetrics" name="CNVkit Segmetrics" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description> calculate summary statitics of the residual bin-level log2 ratio estimates from the segment means </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xrefs"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[  
       ln -s '$input_filename_file' ./sample.cnr &&
       #if $segments
            ln -s '$segments' ./sample.cns &&
       #end if
       cnvkit.py segmetrics
            ./sample.cnr              
            --output gene_segmetrics.cns   
            #if $segments
                --segments ./sample.cns
            #end if                
            $advanced_settings.mean
            $advanced_settings.median
            $advanced_settings.mode
            $advanced_settings.ttest
            $advanced_settings.stdev
            $advanced_settings.sem
            $advanced_settings.mad
            $advanced_settings.mse
            $advanced_settings.iqr
            $advanced_settings.bivar
            $advanced_settings.ci
            $advanced_settings.pi
            $advanced_settings.alpha
            $advanced_settings.bootstrap                   
    ]]></command>
    <inputs>
        <param name="input_filename_file" type="data" format="tabular" label="Processes sample coverage data file" help="cnr format of sample coverage" />
        <param argument="--segments" optional="true" type="data" format="tabular" label="Segments" help="cns format of segmentation calls" />  
        <param argument="--drop-low-coverage" type="boolean" checked="false" truevalue="--drop-low-coverage" falsevalue="" label="Drop very-low-coverage bins" help="Drop very low coverage to avoid false-positive deletions" />
        <section name="advanced_settings" title="Advanced settings" expanded="false">
            <expand macro="genemetrics_segmetrics_statistics" />
        </section>
    </inputs>
    <outputs>
        <data name="gene_segmetrics" format="tabular" label="${tool.name} on ${on_string}: bin-level log2 ratio" from_work_dir="gene_segmetrics.cns" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_filename_file" ftype="tabular" value="sample.cnr" />
            <param name="segments" ftype="tabular" value="sample.cns" />
            <param name="drop_low_coverage" value="1" />
            <param name="mean" value="1" />
            <param name="median" value="1" />
            <param name="mode" value="0" />
            <output name="gene_segmetrics">
                <assert_contents><has_text text="chromosome"/></assert_contents>
            </output> 
        </test>
    </tests>
    <help><![CDATA[
        Segmetrics helps to calculate summary statistics of the residual bin-level log2 ratio estimates from the segment means, similar to 
        the existing metrics command, but for each segment individually. Results are output in the same format as the 
        CNVkit segmentation file (.cns), with the stat names and calculated values printed in additional columns.
    ]]></help>
    <expand macro="citations" />
</tool>



 
